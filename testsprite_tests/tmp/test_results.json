[
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "32c74a6a-8d7c-42a2-bace-66f7630634fd",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC001-test_register_new_agency",
    "description": "Verify that a new agency can be registered successfully with valid input data and returns HTTP status 201.",
    "code": "import requests\n\ndef test_register_new_agency():\n    base_url = \"http://localhost:5001\"\n    url = f\"{base_url}/api/auth/register-agency\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"fullName\": \"Test Agency Admin\",\n        \"email\": \"testagency@example.com\",\n        \"password\": \"StrongPassword123!\",\n        \"agencyName\": \"Test Agency\",\n        \"agencySlug\": \"test-agency\",\n        \"phone\": \"123-456-7890\"\n    }\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=30)\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n    assert response.status_code == 201, f\"Expected status code 201, got {response.status_code}\"\n\ntest_register_new_agency()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 23, in <module>\n  File \"<string>\", line 21, in test_register_new_agency\nAssertionError: Expected status code 201, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.135Z",
    "modified": "2025-09-27T11:19:06.951Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "2ccc22ab-759e-4d5f-86b1-18b01ffddce4",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC002-test_user_login",
    "description": "Verify that a user can login successfully with valid credentials and receives a JWT token with HTTP status 200.",
    "code": "import requests\n\ndef test_user_login():\n    base_url = \"http://localhost:5001\"\n    url = f\"{base_url}/api/auth/login\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"email\": \"user@example.com\",\n        \"password\": \"ValidPassword123!\"\n    }\n    timeout = 30\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=timeout)\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n    assert response.status_code == 200, f\"Expected status 200, got {response.status_code}\"\n    try:\n        data = response.json()\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\n    assert \"token\" in data, \"JWT token not found in response\"\n    token = data[\"token\"]\n    assert isinstance(token, str) and len(token) > 0, \"JWT token is empty or invalid\"\n\ntest_user_login()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 30, in <module>\n  File \"<string>\", line 20, in test_user_login\nAssertionError: Expected status 200, got 401\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.142Z",
    "modified": "2025-09-27T11:19:08.529Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "ae1066d8-d9f8-4037-8179-f37a72308f76",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC003-test_check_user_session",
    "description": "Verify that the user session check endpoint returns HTTP status 200 for a valid JWT token and 401 for invalid or missing token.",
    "code": "import requests\n\ndef test_check_user_session():\n    base_url = \"http://localhost:5001\"\n    endpoint = \"/api/auth/check-session\"\n    valid_token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\n    headers_valid = {\n        \"Authorization\": f\"Bearer {valid_token}\"\n    }\n    # Test with valid token\n    try:\n        response_valid = requests.get(f\"{base_url}{endpoint}\", headers=headers_valid, timeout=30)\n        assert response_valid.status_code == 200, f\"Expected status 200 but got {response_valid.status_code}\"\n    except requests.RequestException as e:\n        assert False, f\"Request with valid token failed: {e}\"\n\n    # Test with invalid token\n    headers_invalid = {\n        \"Authorization\": \"Bearer invalid.token.value\"\n    }\n    try:\n        response_invalid = requests.get(f\"{base_url}{endpoint}\", headers=headers_invalid, timeout=30)\n        assert response_invalid.status_code == 401, f\"Expected status 401 but got {response_invalid.status_code}\"\n    except requests.RequestException as e:\n        assert False, f\"Request with invalid token failed: {e}\"\n\n    # Test with missing token (no Authorization header)\n    try:\n        response_missing = requests.get(f\"{base_url}{endpoint}\", timeout=30)\n        assert response_missing.status_code == 401, f\"Expected status 401 but got {response_missing.status_code}\"\n    except requests.RequestException as e:\n        assert False, f\"Request with missing token failed: {e}\"\n\ntest_check_user_session()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.148Z",
    "modified": "2025-09-27T11:18:45.976Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "6009f406-6f53-4237-9c51-b3e790bfe341",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC004-test_create_property_with_images",
    "description": "Verify that a property can be created with valid data including image uploads and returns HTTP status 201.",
    "code": "import requests\nimport io\n\ndef test_create_property_with_images():\n    base_url = \"http://localhost:5001\"\n    token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\n    headers = {\n        \"Authorization\": f\"Bearer {token}\"\n    }\n\n    # Prepare multipart form data with images\n    # We'll create two in-memory dummy images for upload\n    image1 = io.BytesIO(b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\")\n    image1.name = \"image1.png\"\n    image2 = io.BytesIO(b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x01\")\n    image2.name = \"image2.png\"\n\n    data = {\n        \"title\": \"Spacious Family Home\",\n        \"description\": \"A beautiful 4-bedroom family home in the suburbs.\",\n        \"price\": \"350000\",\n        \"property_type\": \"House\",\n        \"location\": \"1234 Elm Street, Springfield\"\n    }\n    files = [\n        (\"images\", (image1.name, image1, \"image/png\")),\n        (\"images\", (image2.name, image2, \"image/png\")),\n    ]\n\n    property_id = None\n\n    try:\n        response = requests.post(\n            f\"{base_url}/api/properties\",\n            headers=headers,\n            data=data,\n            files=files,\n            timeout=30\n        )\n        assert response.status_code == 201, f\"Expected status 201, got {response.status_code}\"\n        response_json = response.json()\n        # Expect returned json to include created property with an id or _id\n        property_id = response_json.get(\"id\") or response_json.get(\"_id\")\n        assert property_id is not None, \"Response JSON does not contain property ID\"\n    finally:\n        if property_id:\n            # Clean up by deleting the created property\n            try:\n                del_resp = requests.delete(\n                    f\"{base_url}/api/properties/{property_id}\",\n                    headers=headers,\n                    timeout=30\n                )\n                assert del_resp.status_code == 200, f\"Failed to delete property with ID {property_id}\"\n            except Exception:\n                pass\n\n\ntest_create_property_with_images()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 59, in <module>\n  File \"<string>\", line 40, in test_create_property_with_images\nAssertionError: Expected status 201, got 500\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.154Z",
    "modified": "2025-09-27T11:18:52.636Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "1339900a-b998-4ffe-b259-11081a995fae",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC005-test_get_all_properties",
    "description": "Verify that all properties can be retrieved successfully with valid authentication and returns HTTP status 200.",
    "code": "import requests\n\ndef test_get_all_properties():\n    base_url = \"http://localhost:5001\"\n    endpoint = \"/api/properties\"\n    url = base_url + endpoint\n    token = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\n    headers = {\n        \"Authorization\": f\"Bearer {token}\"\n    }\n    try:\n        response = requests.get(url, headers=headers, timeout=30)\n        assert response.status_code == 200, f\"Expected status code 200 but got {response.status_code}\"\n        try:\n            data = response.json()\n            assert isinstance(data, dict), \"Response JSON is not an object\"\n        except ValueError:\n            assert False, \"Response is not valid JSON\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_get_all_properties()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.160Z",
    "modified": "2025-09-27T11:19:00.054Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "c1d339f0-3772-4ba6-9e93-cf21078f6812",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC006-test_update_property_details",
    "description": "Verify that an existing property can be updated with valid data and returns HTTP status 200.",
    "code": "import requests\nfrom requests.exceptions import RequestException\nimport io\n\nBASE_URL = \"http://localhost:5001\"\nTOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\n\nHEADERS = {\n    \"Authorization\": f\"Bearer {TOKEN}\"\n}\n\ndef test_update_property_details():\n    # Create a new property to update later\n    create_url = f\"{BASE_URL}/api/properties\"\n    update_url_template = f\"{BASE_URL}/api/properties/{{}}\"\n    \n    # Use multipart/form-data for creation with images\n    # Since this test case is about update, we'll upload one dummy image (empty) for create\n    property_data_create = {\n        'title': 'Test Property For Update',\n        'description': 'Initial Description',\n        'price': 150000,\n        'property_type': 'Apartment',\n        'location': 'Test City'\n    }\n    files_create = [\n        ('images', ('image1.jpg', io.BytesIO(b'testimagecontent'), 'image/jpeg'))\n    ]\n    \n    timeout = 30\n    property_id = None\n    \n    try:\n        # Create property first\n        response_create = requests.post(\n            create_url,\n            headers=HEADERS,\n            data=property_data_create,\n            files=files_create,\n            timeout=timeout,\n        )\n        assert response_create.status_code == 201, f\"Property creation failed with status {response_create.status_code}, response: {response_create.text}\"\n        created_property = response_create.json()\n        property_id = created_property.get(\"_id\") or created_property.get(\"id\") or created_property.get(\"propertyId\")\n        if not property_id:\n            # Attempt to extract property id from response JSON keys if named differently\n            # Otherwise fail\n            raise AssertionError(\"Property ID not found in create response.\")\n        \n        # Prepare update data: only title, description and price are allowed for update\n        update_url = update_url_template.format(property_id)\n        \n        property_data_update = {\n            'title': 'Updated Property Title',\n            'description': 'Updated Description',\n            'price': 175000\n        }\n        # For update also multipart/form-data is required, so no json param but data and files\n        # No images to upload on update so omit files param\n        \n        response_update = requests.put(\n            update_url,\n            headers=HEADERS,\n            data=property_data_update,\n            timeout=timeout,\n        )\n        assert response_update.status_code == 200, f\"Update failed with status {response_update.status_code}, response: {response_update.text}\"\n        \n        # Optionally validate the response body contains updated details\n        updated_property = response_update.json()\n        assert updated_property.get(\"title\") == property_data_update[\"title\"], \"Title not updated correctly\"\n        assert updated_property.get(\"description\") == property_data_update[\"description\"], \"Description not updated correctly\"\n        # price may come as number or string - do type conversion for assertion\n        updated_price = updated_property.get(\"price\")\n        assert updated_price is not None and float(updated_price) == float(property_data_update[\"price\"]), \"Price not updated correctly\"\n\n    except RequestException as e:\n        raise AssertionError(f\"Request failed: {str(e)}\")\n    finally:\n        # Clean up: delete the created property if exists\n        if property_id:\n            try:\n                delete_url = update_url_template.format(property_id)\n                delete_resp = requests.delete(delete_url, headers=HEADERS, timeout=timeout)\n                # Not asserting in finally, just attempt cleanup\n            except Exception:\n                pass\n\ntest_update_property_details()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 89, in <module>\n  File \"<string>\", line 42, in test_update_property_details\nAssertionError: Property creation failed with status 500, response: {\"message\":\"Error processing files\",\"status\":false}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.166Z",
    "modified": "2025-09-27T11:19:14.092Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "5e91ffbe-4531-42ea-91d9-ce3ba9741200",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC007-test_delete_property",
    "description": "Verify that a property can be deleted successfully by its ID and returns HTTP status 200.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:5001\"\nTOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\nHEADERS = {\"Authorization\": f\"Bearer {TOKEN}\"}\nTIMEOUT = 30\n\ndef test_delete_property():\n    property_id = None\n    create_url = f\"{BASE_URL}/api/properties\"\n    delete_url_template = f\"{BASE_URL}/api/properties/{{}}\"\n    try:\n        # Create a new property to delete\n        multipart_data = {\n            'title': (None, \"Test Property for Deletion\"),\n            'description': (None, \"This property is for testing deletion API.\"),\n            'price': (None, \"100000\"),\n            'property_type': (None, \"Residential\"),\n            'location': (None, \"Test City\"),\n            'category': (None, \"villa\"),\n            'type': (None, \"residential\"),\n        }\n        # No images file uploaded for simplicity\n\n        response_create = requests.post(create_url, headers=HEADERS, files=multipart_data, timeout=TIMEOUT)\n        assert response_create.status_code == 201, f\"Failed to create property: {response_create.text}\"\n        created_data = response_create.json()\n        assert \"id\" in created_data or \"_id\" in created_data, \"Created property ID not found in response.\"\n        property_id = created_data.get(\"id\") or created_data.get(\"_id\")\n        assert property_id, \"Property ID is empty.\"\n\n        # Now delete the created property\n        delete_url = delete_url_template.format(property_id)\n        response_delete = requests.delete(delete_url, headers=HEADERS, timeout=TIMEOUT)\n        assert response_delete.status_code == 200, f\"Delete failed with status {response_delete.status_code}: {response_delete.text}\"\n\n        # Optionally, verify the property no longer exists\n        response_get = requests.get(delete_url, headers=HEADERS, timeout=TIMEOUT)\n        assert response_get.status_code == 404 or response_get.status_code == 400, f\"Property still exists after deletion, get returned {response_get.status_code}\"\n\n    finally:\n        # Cleanup in case delete failed\n        if property_id:\n            # Try to delete again to clean up\n            try:\n                requests.delete(delete_url_template.format(property_id), headers=HEADERS, timeout=TIMEOUT)\n            except Exception:\n                pass\n\ntest_delete_property()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 50, in <module>\n  File \"<string>\", line 28, in test_delete_property\nAssertionError: Created property ID not found in response.\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.173Z",
    "modified": "2025-09-27T11:19:26.717Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "45081ae1-74a1-4bb0-9698-62df31bcd4cd",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC008-test_create_customer",
    "description": "Verify that a new customer can be created with valid data and returns HTTP status 201.",
    "code": "import requests\n\ndef test_create_customer():\n    base_url = \"http://localhost:5001\"\n    endpoint = \"/api/agent/customers/create\"\n    url = base_url + endpoint\n\n    headers = {\n        \"Authorization\": \"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\",\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"name\": \"John Doe\",\n        \"email\": \"johndoe@example.com\",\n        \"phone\": \"+1234567890\",\n        \"address\": \"123 Main St, Anytown, USA\"\n    }\n\n    try:\n        response = requests.post(url, headers=headers, json=payload, timeout=30)\n        assert response.status_code == 201, f\"Expected status 201, got {response.status_code}\"\n        # Optionally validate response data structure or content here if needed\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_create_customer()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 26, in <module>\n  File \"<string>\", line 21, in test_create_customer\nAssertionError: Expected status 201, got 400\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.179Z",
    "modified": "2025-09-27T11:19:08.506Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "da5e8271-756f-4771-a24b-569f9a0c2438",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC009-test_schedule_meeting",
    "description": "Verify that a meeting can be scheduled with valid customer, property, date, and notes and returns HTTP status 201.",
    "code": "import requests\nfrom datetime import datetime, timedelta\n\nBASE_URL = \"http://localhost:5001\"\nTOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\n\nheaders = {\n    \"Authorization\": f\"Bearer {TOKEN}\",\n    \"Content-Type\": \"application/json\"\n}\n\ndef test_schedule_meeting():\n    customer_id = None\n    property_id = None\n    meeting_id = None\n    try:\n        # Create a customer to use for the meeting\n        customer_payload = {\n            \"name\": \"Test Customer\",\n            \"email\": \"testcustomer@example.com\",\n            \"phone\": \"1234567890\",\n            \"address\": \"123 Test St, Test City\"\n        }\n        res_customer = requests.post(\n            f\"{BASE_URL}/api/agent/customers/create\",\n            json=customer_payload,\n            headers=headers,\n            timeout=30\n        )\n        assert res_customer.status_code == 201, f\"Failed to create customer: {res_customer.text}\"\n\n        # Get all customers to find the created customer's ID\n        res_customers = requests.get(\n            f\"{BASE_URL}/api/agent/customers/get-all\",\n            headers=headers,\n            timeout=30\n        )\n        assert res_customers.status_code == 200, f\"Failed to get customers: {res_customers.text}\"\n        customers_list = res_customers.json()\n        found_customer = next((c for c in customers_list if c.get('email') == customer_payload['email']), None)\n        assert found_customer is not None, \"Created customer not found in customers list\"\n        customer_id = found_customer.get(\"id\") or found_customer.get(\"_id\")\n        assert customer_id is not None, \"Customer ID not found\"\n\n        # Create a property to use for the meeting\n        property_payload = {\n            \"title\": \"Test Property\",\n            \"description\": \"A property for testing meetings\",\n            \"price\": 100000.0,\n            \"property_type\": \"Condo\",\n            \"location\": \"Test Location\"\n        }\n\n        multipart_data = {\n            \"title\": property_payload[\"title\"],\n            \"description\": property_payload[\"description\"],\n            \"price\": str(property_payload[\"price\"]),\n            \"property_type\": property_payload[\"property_type\"],\n            \"location\": property_payload[\"location\"],\n        }\n        res_property = requests.post(\n            f\"{BASE_URL}/api/properties\",\n            headers={\"Authorization\": f\"Bearer {TOKEN}\"},\n            data=multipart_data,\n            timeout=30\n        )\n\n        assert res_property.status_code == 201, f\"Failed to create property: {res_property.text}\"\n        property_data = res_property.json()\n        property_id = property_data.get(\"id\") or property_data.get(\"_id\")\n        assert property_id is not None, \"Property ID not returned in response\"\n\n        # Schedule a meeting with the created customer and property\n        meeting_date = (datetime.utcnow() + timedelta(days=1)).isoformat() + \"Z\"  # future date in ISO8601\n        meeting_payload = {\n            \"customerId\": customer_id,\n            \"propertyId\": property_id,\n            \"meetingDate\": meeting_date,\n            \"notes\": \"Discuss details and pricing\"\n        }\n        res_meeting = requests.post(\n            f\"{BASE_URL}/api/agent/meetings/create\",\n            json=meeting_payload,\n            headers=headers,\n            timeout=30\n        )\n        assert res_meeting.status_code == 201, f\"Failed to schedule meeting: {res_meeting.text}\"\n        meeting_id = res_meeting.json().get(\"id\") or res_meeting.json().get(\"_id\")\n        assert meeting_id is not None, \"Meeting ID not returned in response\"\n\n    finally:\n        # Cleanup: delete created meeting, customer, and property if they exist\n        if meeting_id:\n            try:\n                res_del_meeting = requests.delete(\n                    f\"{BASE_URL}/api/agent/meetings/delete/{meeting_id}\",\n                    headers=headers,\n                    timeout=30\n                )\n                assert res_del_meeting.status_code == 200\n            except Exception:\n                pass\n        if customer_id:\n            try:\n                res_del_customer = requests.delete(\n                    f\"{BASE_URL}/api/agent/customers/delete/{customer_id}\",\n                    headers=headers,\n                    timeout=30\n                )\n                assert res_del_customer.status_code == 200\n            except Exception:\n                pass\n        if property_id:\n            try:\n                res_del_property = requests.delete(\n                    f\"{BASE_URL}/api/properties/{property_id}\",\n                    headers=headers,\n                    timeout=30\n                )\n                assert res_del_property.status_code == 200\n            except Exception:\n                pass\n\n\ntest_schedule_meeting()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 125, in <module>\n  File \"<string>\", line 30, in test_schedule_meeting\nAssertionError: Failed to create customer: {\"success\":false,\"message\":\"Full name is required\"}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.184Z",
    "modified": "2025-09-27T11:19:51.727Z"
  },
  {
    "projectId": "61f81957-52d5-4f04-bd96-3440fee1a28f",
    "testId": "620fd3b7-fa3f-4913-aaec-71a1fcd07171",
    "userId": "14188458-7091-7016-ec85-b20848972510",
    "title": "TC010-test_share_property_with_customer",
    "description": "Verify that an agent can share a property with a customer including a message and returns HTTP status 201.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:5001\"\nTOKEN = \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiI2OGM1NWQ3YjJkZjc0MDYyYzgzNDFiZjUiLCJyb2xlIjoiQWdlbmN5QWRtaW4iLCJpYXQiOjE3NTg1MTgxOTQsImV4cCI6MTc2MTExMDE5NH0.l73aUH9lTBe-EazWe8Eydlzxd9SYZmbvBRs35tled-w\"\nHEADERS = {\"Authorization\": f\"Bearer {TOKEN}\"}\n\ndef test_share_property_with_customer():\n    property_id = None\n    customer_id = None\n    share_id = None\n\n    # Create property\n    try:\n        prop_data = {\n            \"title\": \"Test Property \" + str(uuid.uuid4()),\n            \"description\": \"Test property description\",\n            \"price\": 123456.78,\n            \"property_type\": \"Apartment\",\n            \"location\": \"Test Location\"\n        }\n        files = {}\n        # As per PRD, create property expects multipart/form-data with specific fields\n        multipart_data = {\n            \"title\": (None, prop_data[\"title\"]),\n            \"description\": (None, prop_data[\"description\"]),\n            \"price\": (None, str(prop_data[\"price\"])),\n            \"property_type\": (None, prop_data[\"property_type\"]),\n            \"location\": (None, prop_data[\"location\"])\n        }\n        resp_prop = requests.post(f\"{BASE_URL}/api/properties\", headers=HEADERS, files=multipart_data, timeout=30)\n        assert resp_prop.status_code == 201, f\"Property creation failed: {resp_prop.text}\"\n        property_id = resp_prop.json().get(\"id\") or resp_prop.json().get(\"_id\")\n        assert property_id, \"No property ID returned on creation\"\n\n        # Create customer\n        cust_data = {\n            \"name\": \"Test Customer \" + str(uuid.uuid4()),\n            \"email\": f\"testcustomer{uuid.uuid4().hex[:6]}@example.com\",\n            \"phone\": \"123-456-7890\",\n            \"address\": \"123 Test St\"\n        }\n        resp_cust = requests.post(f\"{BASE_URL}/api/agent/customers/create\", headers={**HEADERS, \"Content-Type\": \"application/json\"}, json=cust_data, timeout=30)\n        assert resp_cust.status_code == 201, f\"Customer creation failed: {resp_cust.text}\"\n        customer_id = resp_cust.json().get(\"id\") or resp_cust.json().get(\"_id\")\n        assert customer_id, \"No customer ID returned on creation\"\n\n        # Share property with customer\n        share_payload = {\n            \"propertyId\": property_id,\n            \"customerId\": customer_id,\n            \"message\": \"Sharing this property for your review.\"\n        }\n        resp_share = requests.post(f\"{BASE_URL}/api/agent/shareProperties\", headers={**HEADERS,\"Content-Type\": \"application/json\"}, json=share_payload, timeout=30)\n        assert resp_share.status_code == 201, f\"Property sharing failed: {resp_share.text}\"\n\n    finally:\n        # Cleanup property\n        if property_id:\n            requests.delete(f\"{BASE_URL}/api/properties/{property_id}\", headers=HEADERS, timeout=30)\n        # Cleanup customer\n        if customer_id:\n            requests.delete(f\"{BASE_URL}/api/agent/customers/delete/{customer_id}\", headers=HEADERS, timeout=30)\n\ntest_share_property_with_customer()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 65, in <module>\n  File \"<string>\", line 32, in test_share_property_with_customer\nAssertionError: Property creation failed: {\"success\":false,\"message\":\"Validation Error\",\"errors\":{\"category\":{\"name\":\"ValidatorError\",\"message\":\"Path `category` is required.\",\"properties\":{\"message\":\"Path `category` is required.\",\"type\":\"required\",\"path\":\"category\"},\"kind\":\"required\",\"path\":\"category\"},\"type\":{\"name\":\"ValidatorError\",\"message\":\"Path `type` is required.\",\"properties\":{\"message\":\"Path `type` is required.\",\"type\":\"required\",\"path\":\"type\"},\"kind\":\"required\",\"path\":\"type\"}}}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-09-27T11:18:13.190Z",
    "modified": "2025-09-27T11:19:46.957Z"
  }
]
